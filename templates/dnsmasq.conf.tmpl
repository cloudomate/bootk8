# dnsmasq config — generated by bootstrap node
# Acts as DHCP proxy + TFTP + PXE boot server

# Disable DNS server
port=0

# DHCP proxy — does NOT assign IPs, just adds PXE boot options
# Operates on the provisioning network subnet
dhcp-range=${BOOTSTRAP_IP},proxy

# TFTP root for PXE bootloader delivery
enable-tftp
tftp-root=/var/lib/tftpboot

# For non-iPXE clients: serve iPXE bootloader first
dhcp-boot=undionly.kpxe,,${BOOTSTRAP_IP}

# For clients already running iPXE: serve our boot script directly
dhcp-match=set:ipxe,175
dhcp-boot=tag:ipxe,http://${BOOTSTRAP_IP}:8080/boot.ipxe

# Logging
log-dhcp
log-queries

# Increase lease time visibility
dhcp-lease-max=1000
